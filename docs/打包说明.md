# 群晖NAS文件管理器 EXE打包说明

## 概述

这个文档说明如何将群晖NAS文件管理器打包为Windows可执行文件（EXE），以便在任何Windows电脑上运行而无需安装Python环境。

## 系统要求

- Windows 7/8/10/11
- Python 3.7 或更高版本
- 网络连接（用于下载依赖包）

## 快速开始

### 方法一：使用批处理文件（推荐）

1. **双击运行 `build.bat`**
   ```
   直接双击 build.bat 文件即可开始自动打包
   ```

### 方法二：手动命令行

1. **安装PyInstaller**
   ```bash
   pip install pyinstaller
   ```

2. **运行打包脚本**
   ```bash
   python build_exe.py
   ```

## 详细步骤

### 1. 准备环境

确保您的系统已安装：
- Python 3.7+
- pip 包管理器

### 2. 安装依赖

打包脚本会自动安装所需依赖：
- PyInstaller（打包工具）
- 项目依赖（requests, cryptography等）

### 3. 创建图标（可选）

```bash
python create_icon.py
```

这将生成一个 `app.ico` 图标文件。如果不运行此步骤，程序将使用默认图标。

### 4. 开始打包

运行打包脚本：
```bash
python build_exe.py
```

打包过程包括：
1. 环境检查
2. 依赖安装
3. 创建spec文件
4. PyInstaller打包
5. 文件整理

### 5. 获取结果

打包完成后，您将在 `release/` 目录中找到：
- `群晖NAS文件管理器.exe` - 主程序
- `使用说明.txt` - 使用指南
- `README.md` - 项目说明
- `requirements.txt` - 依赖列表

## 打包配置

### PyInstaller参数说明

```python
--onefile          # 打包成单个exe文件
--windowed         # 不显示控制台窗口
--name=群晖NAS文件管理器  # 指定exe文件名
--icon=app.ico     # 应用程序图标
--clean            # 清理缓存
```

### 包含的模块

打包会自动包含以下关键模块：
- tkinter（GUI框架）
- requests（HTTP客户端）
- cryptography（加密库）
- configparser（配置文件）
- 所有标准库模块

## 常见问题

### 1. 打包失败

**问题**: PyInstaller安装失败
**解决**: 
```bash
pip install --upgrade pip
pip install pyinstaller
```

**问题**: 缺少模块
**解决**: 检查spec文件中的hiddenimports列表

### 2. EXE文件过大

**原因**: PyInstaller会包含所有依赖
**优化**: 
- 使用虚拟环境减少不必要的包
- 使用UPX压缩（已自动启用）

### 3. 运行时错误

**问题**: 找不到模块
**解决**: 在spec文件的hiddenimports中添加缺失模块

**问题**: 编码错误
**解决**: 确保所有文本文件使用UTF-8编码

### 4. 图标不显示

**原因**: app.ico文件不存在或格式错误
**解决**: 运行 `python create_icon.py` 创建图标

## 文件结构

```
项目目录/
├── synology_nas_manager.py    # 主程序
├── requirements.txt           # 依赖列表
├── build_exe.py              # 打包脚本
├── build.bat                 # 批处理文件
├── create_icon.py            # 图标创建脚本
├── app.ico                   # 应用图标（可选）
└── release/                  # 输出目录
    ├── 群晖NAS文件管理器.exe
    ├── 使用说明.txt
    ├── README.md
    └── requirements.txt
```

## 分发说明

### 单文件分发

生成的EXE文件是完全独立的，可以：
1. 复制到任何Windows电脑
2. 无需安装Python或任何依赖
3. 双击直接运行

### 文件大小

- 典型大小：25-50MB
- 包含完整Python运行时
- 已使用UPX压缩优化

### 系统兼容性

- Windows 7/8/10/11
- 32位和64位系统
- 无需管理员权限

## 高级配置

### 自定义图标

1. 准备256x256像素的PNG图像
2. 转换为ICO格式
3. 重命名为 `app.ico`
4. 重新运行打包

### 修改程序信息

编辑 `build_exe.py` 中的参数：
```python
--name=自定义名称
--version-file=版本信息文件
```

### 添加版本信息

创建 `version_info.txt`:
```
VSVersionInfo(
  ffi=FixedFileInfo(
    filevers=(1,0,0,0),
    prodvers=(1,0,0,0),
    # ... 更多版本信息
  )
)
```

## 测试建议

### 打包前测试

1. 确保Python版本能正常运行
2. 测试所有功能模块
3. 验证配置文件读写

### 打包后测试

1. 在干净的Windows系统上测试
2. 测试所有核心功能
3. 验证文件上传下载
4. 测试配置保存加载

## 故障排除

### 查看详细错误

运行时添加控制台输出：
```python
# 在spec文件中设置
console=True
```

### 查看依赖关系

```bash
pyinstaller --collect-all tkinter synology_nas_manager.py
```

### 手动添加文件

在spec文件中添加：
```python
datas=[('config.ini', '.'), ('icon.ico', '.')]
```

## 联系支持

如果打包过程中遇到问题：
1. 检查Python版本兼容性
2. 查看错误日志
3. 参考PyInstaller官方文档
4. 在项目仓库提交Issue

---

**注意**: 打包后的EXE文件首次启动可能较慢（3-10秒），这是正常现象。后续启动会更快。 